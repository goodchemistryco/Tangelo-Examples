<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mifno</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="exploring-the-method-of-increments-with-qemist-cloud-and-tangelo" class="level1">
<h1>Exploring the Method of Increments with QEMIST Cloud and Tangelo</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://colab.research.google.com/github/goodchemistryco/Tangelo/blob/develop/examples/mifno.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" class="img-fluid figure-img"></a></p>
<p></p><figcaption class="figure-caption">Open In Colab</figcaption><p></p>
</figure>
</div>
<p>In this notebook, we illustrate how users can leverage QEMIST Cloud and Tangelo to explore the impact of quantum computing on problems tackled with the MI-FNO problem decomposition technique.</p>
<p>You do not need to have the <code>qemist-client</code> python package installed to run this notebook: only <code>tangelo</code> is required. For more information about <a href="https://goodchemistry.com/qemist-cloud/">QEMIST Cloud</a> (installation, features, issues, <code>qemist_client</code> API…), please refer to the <a href="https://alpha-api.qemist.cloud/#/docs">QEMIST Cloud documentation</a> or contact their development team.</p>
<p>The first section provides a high-level description of the MI-FNO approach. The second one briefly shows how QEMIST Cloud can apply this approach to a usecase, and provide reference results computed with high-accuracy classical solvers. We then focus on the API provided in Tangelo allowing users to combine the MI-FNO performed by QEMIST Cloud and any quantum workflow written with Tangelo.</p>
<p>This notebook assumes that you already have installed Tangelo in your Python environment, or have updated your Python path so that the imports can be resolved. If not, executing the cell below installs the minimal requirements for this notebook.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installation of tangelo if not already installed.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> tangelo</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ModuleNotFoundError:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install git<span class="op">+</span>https:<span class="op">//</span>github.com<span class="op">/</span>goodchemistryco<span class="op">/</span>Tangelo.git<span class="op">@</span>develop <span class="op">--</span>quiet</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the data folder at https://github.com/goodchemistryco/Tangelo/tree/develop/examples/data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isdir(<span class="st">"data"</span>):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>sudo apt install subversion</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>svn checkout https:<span class="op">//</span>github.com<span class="op">/</span>goodchemistryco<span class="op">/</span>Tangelo<span class="op">/</span>branches<span class="op">/</span>develop<span class="op">/</span>examples<span class="op">/</span>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="use-case" class="level2">
<h2 class="anchored" data-anchor-id="use-case">Use case</h2>
<p>Our use case here is the hydrogen fluoride (HF) system defined below, using the <code>sto-3g</code> basis, chosen for simplicity. However, the MI-FNO method can be used to tackle much larger systems.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>HF_coordinates <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">    F    0.0000   0.0000   0.0000</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">    H    0.0000   0.0000   0.9168</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>basis <span class="op">=</span> <span class="st">"sto-3g"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>charge <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>spin <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-mi-fno" class="level2">
<h2 class="anchored" data-anchor-id="what-is-mi-fno">What is MI-FNO ?</h2>
<p>The method of increment (MI) expresses the electron correlation energy of a molecular system as a truncated many-body expansion in terms of orbitals, atoms, molecules, or fragments. The electron correlation of the system is expanded in terms of occupied orbitals, and MI is employed to systematically reduce the occupied orbital space. At the same time, the virtual orbital space is reduced based on the frozen natural orbitals (FNO), which are obtained using a one-particle density matrix from second-order, many-body perturbation theory. In this way, a method referred to as the MI-FNO approach is available for the systematic reduction of both the occupied space and the virtual space in quantum chemistry simulations.</p>
<p>MI was first introduced in quantum chemistry by Nesbet (<a href="https://doi.org/10.1103/PhysRev.155.51">Phys. Rev.&nbsp;1967, 155, 51</a>, <a href="https://doi.org/10.1103/PhysRev.155.56">Phys. Rev.&nbsp;1967, 155, 56</a> and <a href="https://doi.org/10.1103/PhysRev.175.2">Phys. Rev.&nbsp;1968, 175, 2</a>), is based upon the n-body Bethe–Goldstone expansion (<a href="https://doi.org/10.1098/rspa.1957.0017">Proc. R. Soc. A, 1957, 238, 551</a>) of the correlation energy of a molecule. The correlation energy (<span class="math inline">\(E_c\)</span>), defined as the difference between the exact (<span class="math inline">\(E_{\text{exact}}\)</span>) and the Hartree–Fock (mean-field) energy (<span class="math inline">\(E_{\text{HF}}\)</span>), can be expanded as</p>
<p><span class="math display">\[
\begin{align*}
E_c &amp;= E_{\text{exact}} - E_{\text{HF}} \\
&amp;= \sum_i \epsilon_i + \sum_{i&gt;j} \epsilon_{ij} + \sum_{i&gt;j&gt;k} \epsilon_{ijk} + \sum_{i&gt;j&gt;k&gt;l} \epsilon_{ijkl} + \dots
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\epsilon_i\)</span>, <span class="math inline">\(\epsilon_{ij}\)</span>, <span class="math inline">\(\epsilon_{ijk}\)</span>, and <span class="math inline">\(\epsilon_{ijkl}\)</span> are, respectively, the one-, two-, three-, and four-body increments (expansions) defined as</p>
<p><span class="math display">\[
\begin{align*}
\epsilon_i &amp;= E_c(i) \\
\epsilon_{ij} &amp;= E_c(ij) - \epsilon_i - \epsilon_j \\
\epsilon_{ijk} &amp;= E_c(ijk) - \epsilon_{ij} - \epsilon_{ik} - \epsilon_{jk} - \epsilon_{i} - \epsilon_{j} - \epsilon_{k} \\
\epsilon_{ijkl} &amp;= E_c(ijkl) - \epsilon_{ijk} - \epsilon_{ijl} - \epsilon_{jkl} - \dots \\
&amp;\vdots
\end{align*}
\]</span></p>
<p>The following figure, taken from <a href="https://doi.org/10.1063/5.0054647">J. Chem. Phys. 2021, 155, 034110</a>, illustrates this problem decomposition scheme in terms of 1-body and many-body interactions. On each subproblem, an FNO truncation is applied to reduce their virtual space. The subproblems resulting from the MI-FNO reduction can then be solved by any algorithm, including quantum algorithms such as the phase estimation algorithm and the variational quantum eigensolver (VQE), to predict the correlation energies of a molecular system.</p>
<div>
<p><img src="../img/mifno.png" width="600"></p>
</div>
<p>This problem decomposition pipeline is available in QEMIST Cloud. In this notebook, we illustrate how to export MI-FNO fragment data computed in QEMIST Cloud, and import it in Tangelo for further treatment, such as using quantum solvers.</p>
</section>
<section id="performing-mi-fno-calculations-with-qemist-cloud" class="level2">
<h2 class="anchored" data-anchor-id="performing-mi-fno-calculations-with-qemist-cloud">Performing MI-FNO calculations with QEMIST Cloud</h2>
<p><a href="https://goodchemistry.com/qemist-cloud/">QEMIST Cloud</a> is an engine that enables faster, more accurate, and scalable ways to perform computational chemistry simulations. This platform leverages easily and readily accessible computers on the cloud to perform chemistry simulations that were previously intractable even on expensive, high-performance computing environments.</p>
<p>In order to leverage this platform to perform the MI-FNO calculations, subscribing to the services and installing the <code>qemist_client</code> python package is necessary. This notebook does not require either of these things: we provide the code snippet used to generate the problem decomposition results, and use those as pre-computed values for the rest of the notebook.</p>
<p>For more information about QEMIST Cloud (installation, features, issues, <code>qemist_client</code> API…), please refer to the <a href="https://alpha-api.qemist.cloud/#/docs">QEMIST Cloud documentation</a> or contact their development team.</p>
<p>In the script below, each fragment’s virtual space is truncated to keep only the virtual orbitals with the highest occupation number. MI-FNO is paired with the Heath-Bath Configuration Interaction (HBCI) classical solver.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'QEMIST_PROJECT_ID'</span>] <span class="op">=</span> <span class="st">"your_project_id_string"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'QEMIST_AUTH_TOKEN'</span>] <span class="op">=</span> <span class="st">"your_qemist_authentication_token"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qemist_client.molecule <span class="im">import</span> Molecule</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qemist_client.problem_decomposition <span class="im">import</span> IncrementalDecomposition</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qemist_client.problem_reduction <span class="im">import</span> FNO</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qemist_client.electronic_structure_solvers <span class="im">import</span> HBCI</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qemist_client.util <span class="im">import</span> get_results</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>HF_coordinates <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">    F    0.0000   0.0000   0.0000</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">    H    0.0000   0.0000   0.9168</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>basis <span class="op">=</span> <span class="st">"sto-3g"</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>charge <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>spin <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the QEMIST molecule object.</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>HF_mol <span class="op">=</span> Molecule(HF_coordinates, basis<span class="op">=</span>basis, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                  charge<span class="op">=</span>charge, spin<span class="op">=</span>spin)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the solvers, Heath-Bath Configuration Interaction (HBCI),</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Frozen Natural Orbitals (FNO), and the problem decomposition approach,</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Method of Increments (MI).</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>hbci_solver <span class="op">=</span> HBCI()</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>fno <span class="op">=</span> FNO(hbci_solver, export_fragment_data<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>mi_solver <span class="op">=</span> IncrementalDecomposition(solver<span class="op">=</span>fno, truncation_order<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Submitting the problem to the cloud.</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>HF_handle <span class="op">=</span> mi_solver.simulate(molecule<span class="op">=</span>HF_mol)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">HF handle: </span><span class="sc">{</span>HF_handle<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieving the results.</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>HF_result <span class="op">=</span> get_results(HF_handle)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(HF_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>HF_result</code> python dictionary can be saved in a json file (for further treatment in Tangelo or for archiving purposes) with the following code.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"your_file_path"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    json.dump(HF_result, f)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n__trunc, frags <span class="kw">in</span> HF_result[<span class="st">"subproblem_data"</span>].items():</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> frag_id, frag <span class="kw">in</span> frags.items():</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        prob_handle <span class="op">=</span> frag[<span class="st">"problem_handle"</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> problem_handle:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            frag_res <span class="op">=</span> get_results(prob_handle)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"your_folder_path"</span><span class="op">/</span>{prob_handle}.json<span class="st">", "</span>w<span class="st">") as f:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="er">                json.dump(frag_res, f)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="combining-quantum-algorithms-with-mi-fno-using-tangelo" class="level2">
<h2 class="anchored" data-anchor-id="combining-quantum-algorithms-with-mi-fno-using-tangelo">Combining quantum algorithms with MI-FNO using Tangelo</h2>
<p>In the future, pairing problem decomposition techniques such as MI-FNO with quantum solvers running in the cloud could be streamlined in QEMIST Cloud, which could directly call the solvers available in Tangelo.</p>
<p>But we think quantum hardware and quantum algorithm development has a bit of a way to go before this can be seen as a practical approach. However, we can manually explore how to combine MI-FNO with quantum solvers right now, in order to explore use cases intractable otherwise: maybe our discoveries can contribute in advancing the field, and bring that future a bit sooner.</p>
<p>This section illustrates how Tangelo can retrieve the results from a MI-FNO job run in QEMIST Cloud, and enable our quantum explorations.</p>
<section id="importing-results-from-qemist-cloud" class="level3">
<h3 class="anchored" data-anchor-id="importing-results-from-qemist-cloud">1. Importing results from QEMIST Cloud</h3>
<p>In Tangelo, the <code>MIFNOHelper</code> class facilitates importing the results generated by QEMIST Cloud, in our case contained in the <code>HF_result</code> object.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo.problem_decomposition <span class="im">import</span> MIFNOHelper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>MIFNOHelper</code> can either directly take a “results” object in json format produced by QEMIST Cloud (using <code>results_object=...</code>), or the path to a file containing that object (using <code>json_file=...</code>). In our example, let’s just assume <code>HF_results</code> has been saved in <code>../data/HF_MIFNO_trunc2.json</code> and let’s see what information has been retrieved.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fno_fragments <span class="op">=</span> MIFNOHelper(mi_json_file<span class="op">=</span><span class="st">"./data/HF_STO3G_MIFNO_HBCI.json"</span>, fno_json_folder<span class="op">=</span><span class="st">"./data"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fno_fragments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(All the energy values are in hartree)
Total MI-FNO energy = -98.59655271223816
Correlation energy = -0.025795120623911316
Mean-field energy = -98.57075759161424
              problem_handle   epsilon  energy_correlation  correction  \
(1,)       65652562505002413 -0.001326           -0.001326         0.0   
(2,)       10837505518890413 -0.019846           -0.019846         0.0   
(3,)       31462118862908845 -0.000862           -0.000862         0.0   
(4,)       49501973643554221 -0.000756           -0.000756         0.0   
(1, 2)     65302015864237516 -0.003024           -0.024195         0.0   
(1, 3)     53405772498103756  0.000085           -0.002102         0.0   
(1, 4)     13411621153304012  0.000142           -0.001939         0.0   
(2, 3)     22700772126125516 -0.000845           -0.021553         0.0   
(2, 4)     27549614109650380  0.000124           -0.020477         0.0   
(3, 4)     23150438022147532  0.000078           -0.001540         0.0   
(1, 2, 3)  30910159730798073  0.000466           -0.025351         0.0   
(1, 2, 4)  13137250052500985 -0.000016           -0.024701         0.0   
(2, 3, 4)  17864205159132665 -0.000017           -0.022123         0.0   

           energy_total  
(1,)         -98.572083  
(2,)         -98.590604  
(3,)         -98.571619  
(4,)         -98.571513  
(1, 2)       -98.594953  
(1, 3)       -98.572860  
(1, 4)       -98.572697  
(2, 3)       -98.592310  
(2, 4)       -98.591235  
(3, 4)       -98.572297  
(1, 2, 3)    -98.596109  
(1, 2, 4)    -98.595458  
(2, 3, 4)    -98.592881  </code></pre>
</div>
</div>
<p>It parsed information contained in the “result blob” from QEMIST Cloud. We see that there is information about the whole system, including the mean-field energy and the total energy, as well as how each of the fragment -denoted by a tuple of integers- contributed to the correlation energy.</p>
<p>Although not displayed here, the object also contains information about the frozen orbitals used for each of these fragments (“frozen lists”).</p>
</section>
<section id="importing-molecular-coefficients-files" class="level3">
<h3 class="anchored" data-anchor-id="importing-molecular-coefficients-files">2. Importing molecular coefficients files</h3>
<p>In order to build a <code>FermionOperator</code> or <code>QubitOperator</code> object compatible with our quantum algorithms, we can retrieve the MO coeffs exported by QEMIST Cloud. The “result blob” contains a URL where these are located, for each fragment: the <code>retrieve_mo_coeff</code> method downloads them in the target directory provided by the user, and then loads the MO coeffs into the <code>MIFNOHelper</code> object.</p>
<ul>
<li>The default target folder is the folder where the user script is executed.</li>
<li>If the user does not provide a path to a valid existing directory, the call returns an error.</li>
<li>If the files already exists in the target directory, they are not re-downloaded. The method keeps the user informed of progress as it is downloading files, otherwise it prints nothing.</li>
</ul>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fno_fragments.retrieve_mo_coeff(<span class="st">"./data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reconstructing-a-fragment-hamiltonian" class="level3">
<h3 class="anchored" data-anchor-id="reconstructing-a-fragment-hamiltonian">3. Reconstructing a fragment Hamiltonian</h3>
<p>We can use the MO coeffs to modify the molecular integrals, in order to take into account the FNO localization, using our “frozen lists”.</p>
<p>The <code>compute_fermionoperator</code> method handles the frozen orbitals for each fragment, and produces a <code>FermionOperator</code>. We are free to use the qubit mapping of our choice to produce a <code>QubitOperator</code> object, as input for a quantum algorithm.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo <span class="im">import</span> SecondQuantizedMolecule</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo.toolboxes.operators <span class="im">import</span> count_qubits</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo.toolboxes.qubit_mappings.mapping_transform <span class="im">import</span> fermion_to_qubit_mapping</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Needed to compute the molecular integrals.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>mol <span class="op">=</span> SecondQuantizedMolecule(HF_coordinates, q<span class="op">=</span>charge, spin<span class="op">=</span>spin, basis<span class="op">=</span>basis)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Selection of a fragment and fetching the number of electrons and spinorbitals.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>selected_fragment <span class="op">=</span> <span class="st">"(1,)"</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>n_electrons, n_spinorbitals <span class="op">=</span> fno_fragments.n_electrons_spinorbs(selected_fragment)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the related FermionOperator.</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>ferm_op <span class="op">=</span> fno_fragments.compute_fermionoperator(mol, selected_fragment)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation of the FermionOperator to a QubitOperator.</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>qu_op <span class="op">=</span> fermion_to_qubit_mapping(ferm_op, mapping<span class="op">=</span><span class="st">"JW"</span>, up_then_down<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fragment </span><span class="sc">{</span>selected_fragment<span class="sc">}</span><span class="ss"> mapped to </span><span class="sc">{</span>count_qubits(qu_op)<span class="sc">}</span><span class="ss"> qubits."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fragment (1,) mapped to 4 qubits.</code></pre>
</div>
</div>
</section>
<section id="do-your-thing" class="level3">
<h3 class="anchored" data-anchor-id="do-your-thing">4. Do your thing !</h3>
<p>Now that we are able to construct <code>FermionOperator</code> and <code>QubitOperator</code> objects representing the subproblems defined by our fragments, we are free to throw them at any algorithm available in Tangelo. You could even decide to use your own custom workflow instead. Each fragment that is relevant to you could be solved with a different quantum solver, if you wish to do so.</p>
<p>Below, we treat a given fragment with Quantum Imaginary Time Evolution (QITE) to obtain its energy. We made sure to enter values for <code>n_electrons</code> and <code>n_spinorbitals</code> that are consistent with our MI-FNO parameters.</p>
<p>This code cell can take several minutes to execute. After its execution, the value of <code>qite.final_energy</code> should be about <code>-98.57208</code>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo.algorithms.projective <span class="im">import</span> QITESolver</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tangelo.toolboxes.operators <span class="im">import</span> qubitop_to_qubitham</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>qubit_ham <span class="op">=</span> qubitop_to_qubitham(qu_op, mapping<span class="op">=</span><span class="st">"JW"</span>, up_then_down<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>qite <span class="op">=</span> QITESolver({<span class="st">"qubit_hamiltonian"</span>: qubit_ham, <span class="st">"n_electrons"</span>: n_electrons, <span class="st">"n_spinorbitals"</span>: n_spinorbitals})</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>qite.build()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>qite.simulate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 1 of QITE with starting energy -98.57075759161438
Iteration 2 of QITE with starting energy -98.57113742411626
Iteration 3 of QITE with starting energy -98.57140787803424
Iteration 4 of QITE with starting energy -98.57160051304115
Iteration 5 of QITE with starting energy -98.5717377800637
Iteration 6 of QITE with starting energy -98.5718356478243
Iteration 7 of QITE with starting energy -98.57190547369781
Iteration 8 of QITE with starting energy -98.57195533540128
Iteration 9 of QITE with starting energy -98.57199097845572
Iteration 10 of QITE with starting energy -98.57201649005955
Iteration 11 of QITE with starting energy -98.57203477827191
Iteration 12 of QITE with starting energy -98.57204791270738
Iteration 13 of QITE with starting energy -98.57205736674561
Iteration 14 of QITE with starting energy -98.57206418972217
Iteration 15 of QITE with starting energy -98.57206912934107
Iteration 16 of QITE with starting energy -98.57207271870293
Iteration 17 of QITE with starting energy -98.57207533818271
Iteration 18 of QITE with starting energy -98.57207725942834
Iteration 19 of QITE with starting energy -98.57207867665228
Iteration 20 of QITE with starting energy -98.57207972888882
Iteration 21 of QITE with starting energy -98.5720805158298
Iteration 22 of QITE with starting energy -98.5720811090937
Iteration 23 of QITE with starting energy -98.57208156024942
Iteration 24 of QITE with starting energy -98.5720819065301
Iteration 25 of QITE with starting energy -98.57208217490502
Iteration 26 of QITE with starting energy -98.57208238498288
Iteration 27 of QITE with starting energy -98.57208255108415
Iteration 28 of QITE with starting energy -98.57208268372021
Iteration 29 of QITE with starting energy -98.57208279065223
Final energy of QITE is -98.57208287764851</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>-98.57208287764851</code></pre>
</div>
</div>
</section>
<section id="recomputing-the-total-energy-of-the-system" class="level3">
<h3 class="anchored" data-anchor-id="recomputing-the-total-energy-of-the-system">5. Recomputing the total energy of the system</h3>
<p>In order to assess the impact of quantum workflows applied to one or several fragments on the total energy of the system, the helper class provides a <code>mi_summation</code> method. This class recomputes the total energy of the system, using the reference values obtained classically by QEMIST Cloud, or instead using the values obtained by your quantum workflows for the fragments you specify. This summation was described by the formulas in the first section of this notebook.</p>
<p>If no argument is passed to <code>mi_summation</code>, then only reference values are used in the summation, which should then be in agreement (up to machine precision) with <code>fno_fragments.e_tot</code>, originally read from the QEMIST Cloud result blob.</p>
<p>Otherwise, passing a dictionary using fragment labels as keys and the energy as the corresponding values does the trick. For these fragments, MP2 correction is automatically added, and a new total energy is computed.</p>
<p>The difference between this new total energy and the reference total energy gives you a measure of the accuracy and the impact of combining quantum workflows with classical calculations performed with MI-FNO.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> fno_fragments.mi_summation({<span class="st">"(1,)"</span>: qite.final_energy})</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Reconstructed energy: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ch">\n</span><span class="ss">MIFNO QEMIST Cloud energy: </span><span class="sc">{</span>fno_fragments<span class="sc">.</span>e_tot<span class="sc">}</span><span class="ch">\n</span><span class="ss">Difference: </span><span class="sc">{</span><span class="bu">abs</span>(e<span class="op">-</span>fno_fragments.e_tot)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reconstructed energy: -98.59655271223812
MIFNO QEMIST Cloud energy: -98.59655271223816
Difference: 4.263256414560601e-14</code></pre>
</div>
</div>
</section>
</section>
<section id="closing-words" class="level2">
<h2 class="anchored" data-anchor-id="closing-words">Closing words</h2>
<p>This feature allows us to bring together the state-of-the-art MI-FNO problem decomposition schemes available at scale in QEMIST cloud, and quantum workflows written with Tangelo. It facilitates exploring larger, more industrially-relevant use cases with a combination of classical and quantum workflows of your choice, on subproblems that are more ammenable to current devices.</p>
<p>For now, this exploration is manual, as we believe the current state of the field does not benefit from a fully automated and streamlined platform… yet! In the future, platforms such as QEMIST Cloud will be able to directly use Tangelo to run entire workflows on cloud infrastructure, using both quantum and classical devices.</p>
<p>Maybe your discoveries can contribute to advancing the field, and bring that future a bit sooner.</p>
<p>What will you do with Tangelo?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>